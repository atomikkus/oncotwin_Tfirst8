version: '3.8'

services:
  # The OncoTwin API service
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: oncotwin_api
    ports:
      - "8001:8001"
    volumes:
      # Mount the api_outputs directory to persist results on the host machine
      - ./api_outputs:/app/api_outputs
    environment:

      
      - USER_EMAIL=${USER_EMAIL}
      - USER_PASSWORD=${USER_PASSWORD}
      - ECRF_EMAIL=${ECRF_EMAIL}
      - ECRF_PASSWORD=${ECRF_PASSWORD}
      
      # Environment variables for connecting to the Redis service
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_DB=0
    depends_on:
      - redis
    restart: unless-stopped

  # The Redis cache service
  redis:
    image: "redis:alpine"
    container_name: oncotwin_redis
    ports:
      # Expose Redis on the host for debugging, but the API will use the internal network
      - "6379:6379"
    volumes:
      # Persist Redis data across container restarts
      - redis_data:/data
    restart: unless-stopped

volumes:
  redis_data: 